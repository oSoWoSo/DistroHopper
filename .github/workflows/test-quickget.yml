name: "Test quickget ğŸ§ª"

on:
  workflow_dispatch:
  push:
    branches:
      - master
    paths:
      - quickget
  pull_request:
    branches:
      - '**'
    paths:
      - quickget

jobs:
  quickget-tests:
    name: "Run quickget tests ğŸ‘Ÿ"
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      - name: "Install dependencies ğŸ“¦ï¸"
        run: |
          sudo apt-get -y update
          sudo apt-get -y install curl qemu-utils
      - name: "List OS variants ğŸ“ƒ"
        run: |
          mkdir -p results
          ./quickget --list | tail -n +2 | tee results/list.txt
      - name: "Check OS downloads ğŸ’¿ï¸"
        run: |
          mkdir -p results
          ./quickget --check | tee results/check.txt
      - name: "Display results ğŸ“Š"
        run: |
          FAILED=$(grep -c ^FAIL results/check.txt)
          SKIPPED=$(grep -c ^SKIP results/check.txt)
          PASSED=$(grep -c ^PASS results/check.txt)
          CHECKED=$((FAILED + SKIPPED + PASSED))
          echo -e "\nResults:"
          echo -e "- CHECKED:\t${CHECKED}"
          echo -e "- PASSED:\t${PASSED}"
          echo -e "- SKIPPED:\t${SKIPPED}"
          echo -e "- FAILED:\t${FAILED}\n"
          grep ^FAIL results/check.txt | tee results/failed.txt
          VARIATIONS=$(wc -l results/list.txt | cut -d' ' -f 1)
          DOWNLOADS=$(wc -l results/check.txt | cut -d' ' -f 1)
          echo
          echo "Compare OS variations with downloads:"
          echo -e "- Variations:\t${VARIATIONS}"
          echo -e "- Downloads:\t${DOWNLOADS}"
